---
title: "Microsoft ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ Vision ãƒ¢ãƒ‡ãƒ« Florence2 ã‚’è©¦ã™"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [florence2, vision]
published: true
---

## Florence2 ã¨ã¯

> Florence-2: Advancing a Unified Representation for a Variety of Vision Tasks

Florence2 ã¯ Microsoft ãŒæä¾›ã™ã‚‹ Vision ãƒ¢ãƒ‡ãƒ«ã§ã€æ§˜ã€…ãª Vision ã‚¿ã‚¹ã‚¯ã«å¯¾å¿œã—ãŸã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚  
å¤§ããªç‰¹å¾´ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- ã‚¼ãƒ­ã‚·ãƒ§ãƒƒãƒˆã§æ§˜ã€…ãªã‚¿ã‚¹ã‚¯ã«å¯¾å¿œ
  - ç‰©ä½“æ¤œå‡º
  - ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆ
  - ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  - ç”»åƒå†…æ¤œç´¢
  - OCR
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ™ãƒ¼ã‚¹ã§åˆ©ç”¨å¯èƒ½
- è»½é‡ãªãŒã‚‰é«˜æ€§èƒ½

ã‚ˆã‚Šè©³ç´°ãªã‚¹ãƒšãƒƒã‚¯ã‚„ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://huggingface.co/microsoft/Florence-2-large#benchmarks

ã¾ãŸå„æ©Ÿèƒ½ã®ä¾‹ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ãŒã¨ã¦ã‚‚ã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

https://huggingface.co/microsoft/Florence-2-large/blob/main/sample_inference.ipynb

## å®Ÿè¡Œç’°å¢ƒ

ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒŠã« `transformers` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚Œã°å®Ÿè¡Œã§ãã¾ã™ã€‚

- [nvcr.io/nvidia/pytorch:24.02-py3](https://docs.nvidia.com/deeplearning/frameworks/pytorch-release-notes/rel-24-02.html)
  - OS: Ubuntu 22.04
  - python: 3.10.12
  - PyTorch: 2.3.0a0
  - Cuda: 12.3
- GPU: Quadro RTX 5000

## è©¦ã—ã¦ã¿ãŸ

ä»¥ä¸‹ã®ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã®ç”»åƒã‚’ä½¿ã£ã¦ã€å„ã‚¿ã‚¹ã‚¯ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚  
ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã®ç”»åƒã‚’ä½¿ã†ã®ã¯ã€ã“ã‚Œã‚’è©¦ã—ãŸå½“æ™‚ã‚³ãƒ­ãƒŠã«æ„ŸæŸ“ã—ã¦ãŸã‹ã‚‰ã§ã™ã€‚

![covid-19 virus image](/images/florence2/covid.jpg)

å¼•ç”¨å…ƒ: [æ±äº¬éƒ½å¥åº·å®‰å…¨ç ”ç©¶ã‚»ãƒ³ã‚¿ãƒ¼ Â» æ–°å‹ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã®é›»å­é¡•å¾®é¡å†™çœŸ (ã‚ªãƒŸã‚¯ãƒ­ãƒ³æ ªã®å†™çœŸã‚’è¿½åŠ ) (tokyo.lg.jp)](https://www.tmiph.metro.tokyo.lg.jp/lb_virus/kansenshou/virus_gazou/sars-cov-2/)

å®Ÿè¡Œã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã€`run_example` ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ãŸã™å¼•æ•°ã§ã‚¿ã‚¹ã‚¯ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚

```python
from PIL import Image
from transformers import AutoProcessor, AutoModelForCausalLM
import torch


device = "cuda" if torch.cuda.is_available() else "cpu"
model = AutoModelForCausalLM.from_pretrained(
    "microsoft/Florence-2-large", trust_remote_code=True
).to(device)
processor = AutoProcessor.from_pretrained(
    "microsoft/Florence-2-large", trust_remote_code=True
)
image = Image.open(open("./covid-19.jpg", "rb"))


def run_example(task_prompt, text_input=None):
    if text_input is None:
        prompt = task_prompt
    else:
        prompt = task_prompt + text_input
    inputs = processor(text=prompt, images=image, return_tensors="pt").to(device)

    generated_ids = model.generate(
        input_ids=inputs["input_ids"],
        pixel_values=inputs["pixel_values"],
        max_new_tokens=1024,
        num_beams=3,
    )

    generated_text = processor.batch_decode(generated_ids, skip_special_tokens=False)[0]

    parsed_answer = processor.post_process_generation(
        generated_text, task=task_prompt, image_size=(image.width, image.height)
    )

    return parsed_answer
```

### ç‰©ä½“æ¤œå‡º

```python
results = run_example("<OD>")
```

ä»¥ä¸‹ã®é–¢æ•°ã§ç”»åƒä¸Šã«çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```python
import matplotlib.pyplot as plt
import matplotlib.patches as patches
def plot_bbox(image, data):
   # Create a figure and axes
    fig, ax = plt.subplots()

    # Display the image
    ax.imshow(image)

    # Plot each bounding box
    for bbox, label in zip(data['bboxes'], data['labels']):
        # Unpack the bounding box coordinates
        x1, y1, x2, y2 = bbox
        # Create a Rectangle patch
        rect = patches.Rectangle((x1, y1), x2-x1, y2-y1, linewidth=1, edgecolor='r', facecolor='none')
        # Add the rectangle to the Axes
        ax.add_patch(rect)
        # Annotate the label
        plt.text(x1, y1, label, color='white', fontsize=8, bbox=dict(facecolor='red', alpha=0.5))

    # Remove the axis ticks and labels
    ax.axis('off')

    # Show the plot
    plt.show()
```

```python
plot_bbox(image, results["<OD>"])
```

![ç‰©ä½“æ¤œå‡ºçµæœã¯ invertebrate](/images/florence2/OD_Result.png)

`invertebrate` ã¨ã„ã†è¦‹æ…£ã‚Œãªã„ãƒ©ãƒ™ãƒ«ãŒä»˜ä¸ã•ã‚Œã¦ã„ã¾ã™ãŒã€æ—¥æœ¬èªã§è¨€ã†ã¨ç„¡è„Šæ¤å‹•ç‰©ã®ã“ã¨ã§ã™ã€‚  
ã‚¦ã‚¤ãƒ«ã‚¹ãŒç„¡è„Šæ¤å‹•ç‰©ãªã®ã‹ã¯å°‚é–€å¤–ãªã®ã§ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€å°‘ãªãã¨ã‚‚æœŸå¾…ã—ãŸçµæœã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

æ¬¡ã« Phrase Grounding ã¨ã„ã†ã‚¿ã‚¹ã‚¯ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚  
ã“ã®ã‚¿ã‚¹ã‚¯ã¯ã€ç”»åƒã¨ãã® Context ã‚’ä¸ãˆã‚‹ã“ã¨ã§ Context ã«åŸºã¥ã„ã¦ç”»åƒå†…ã®ç‰©ä½“ã‚’ç‰¹å®šã™ã‚‹ã‚¿ã‚¹ã‚¯ã§ã™ã€‚  
ä»Šå›ã¯ "ã‚¦ã‚¤ãƒ«ã‚¹ã®ç™½é»’é¡•å¾®é¡åƒ" ã¨ã„ã† Context ã‚’ä¸ãˆã¦ã¿ã¾ã™ã€‚

```python
task_prompt = '<CAPTION_TO_PHRASE_GROUNDING>'
results = run_example(task_prompt, text_input="A black and white microscopic view of a virus.")
```

```python
plot_bbox(image, results['<CAPTION_TO_PHRASE_GROUNDING>'])
```

![Phrase Grounding ã§ã‚¦ã‚¤ãƒ«ã‚¹ã‚’æ¤œçŸ¥](/images/florence2/PG_Result.png.png)

é©åˆ‡ãª Context ã‚’ä¸ãˆã‚‹ã“ã¨ã§ã€ã‚¦ã‚¤ãƒ«ã‚¹ã‚’æ¤œçŸ¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã¿ãŸã„ãªã“ã¨ã‚’ã›ãšã«å‡ºåŠ›ã‚’åˆ¶å¾¡ã§ãã‚‹ã®ã¯ã€éå¸¸ã«ä¾¿åˆ©ã ã¨æ„Ÿã˜ã¾ã™ã€‚

### ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆ

```python
run_example("<CAPTION>")
# {'<CAPTION>': 'a black and white image of a small hole in the ground'}
```

ç”»åƒã‚’ç«¯çš„ã«èª¬æ˜ã™ã‚‹ã«ã¯ååˆ†ã§ã™ãŒã€ã“ã®èª¬æ˜ã ã¨å…·ä½“çš„ã«ä½•ã‚’ç¤ºã™ç”»åƒãªã®ã‹ãŒã‚ã‹ã‚Šã¾ã›ã‚“ã€‚
ã‚ˆã‚Šè©³ã—ã„èª¬æ˜ã‚’ç”Ÿæˆã•ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python
run_example("<MORE_DETAILED_CAPTION>")
# {'<MORE_DETAILED_CAPTION>': 'The image is a black and white microscopic view of a small, circular object. The object appears to be made up of small, irregularly shaped particles that are densely packed together. The particles are arranged in a way that they form a ring-like shape, with the center of the object being the largest and the outermost. The surface of the surface is covered in small, textured particles, giving it a textured appearance. The image is taken from a top-down perspective, looking down on the object.'}
```

> The image is a black and white microscopic view of a small, circular object. The object appears to be made up of small, irregularly shaped particles that are densely packed together. The particles are arranged in a way that they form a ring-like shape, with the center of the object being the largest and the outermost. The surface of the surface is covered in small, textured particles, giving it a textured appearance. The image is taken from a top-down perspective, looking down on the object.

å‡ºåŠ›çµæœã‚’æ—¥æœ¬èªã«ç¿»è¨³ã—ã¦ã¿ã¾ã™ã€‚

> ç”»åƒã¯å°ã•ãªå††å½¢ã®ç‰©ä½“ã®ç™½é»’é¡•å¾®é¡å†™çœŸã§ã‚ã‚‹ã€‚ã“ã®ç‰©ä½“ã¯ã€å°ã•ãªä¸è¦å‰‡ãªå½¢ã®ç²’å­ãŒå¯†é›†ã—ã¦ã§ãã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚ç²’å­ã¯ãƒªãƒ³ã‚°çŠ¶ã«ãªã‚‹ã‚ˆã†ã«ä¸¦ã‚“ã§ãŠã‚Šã€ç‰©ä½“ã®ä¸­å¿ƒãŒæœ€ã‚‚å¤§ããã€æœ€ã‚‚å¤–å´ã«ã‚ã‚‹ã€‚è¡¨é¢ã¯å°ã•ãªç²’å­ã§è¦†ã‚ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¼ãŒã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚ç”»åƒã¯ä¸Šã‹ã‚‰è¦‹ä¸‹ã‚ã—ãŸè¦–ç‚¹ã§æ’®å½±ã•ã‚Œã¦ã„ã‚‹ã€‚

ç”»åƒã®ç‰¹å¾´ã¯ã‚ˆãæ‰ãˆã‚‰ã‚Œã¦ãŠã‚Šã€ã“ã‚ŒãŒé¡•å¾®é¡ã§æ’®å½±ã—ãŸä½•ã‚‰ã‹ã®ç‰©ä½“ã§ã‚ã‚‹ã“ã¨ã‚‚ç†è§£ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚  
ãŸã ã€ã“ã‚ŒãŒã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã§ã‚ã‚‹ã“ã¨ã¾ã§ã¯èª¬æ˜ã§ãã¦ã„ãªã„ã‚ˆã†ã§ã—ãŸã€‚

:::details Caption çµæœã‚’ LLM ã«æ¸¡ã—ã¦ã¿ã‚‹
ã“ã®èª¬æ˜ãŒã©ã‚Œã ã‘é©åˆ‡ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ LLM ã«æ¸¡ã—ã¦ã¿ã¾ã™ã€‚  
ä»Šå›ã¯ Claude 3.5 sonnet ã‚’åˆ©ç”¨ã—ã¦ã¿ã¾ã™ã€‚

å…¥åŠ›:

> ä»¥ä¸‹ã®èª¬æ˜ã¯ã€ã¨ã‚ã‚‹ç‰©ä½“ã®é›»å­é¡•å¾®é¡åƒã®èª¬æ˜ã§ã™ã€‚ã“ã®èª¬æ˜ã«å½“ã¦ã¯ã¾ã‚‹ç‰©ä½“ã‚’æ•™ãˆã¦ä¸‹ã•ã„
> The image is a black and white microscopic view of a small, circular object. The object appears to be made up of small, irregularly shaped particles that are densely packed together. The particles are arranged in a way that they form a ring-like shape, with the center of the object being the largest and the outermost. The surface of the surface is covered in small, textured particles, giving it a textured appearance. The image is taken from a top-down perspective, looking down on the object.

å‡ºåŠ›:

> ã“ã®èª¬æ˜ã«å½“ã¦ã¯ã¾ã‚‹ç‰©ä½“ã¯ã€é«˜ã„å¯èƒ½æ€§ã§ã€Œã‚¦ã‚¤ãƒ«ã‚¹ç²’å­ã€ã€ç‰¹ã«ã€Œã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã€ã ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚
>
> ãã®ç†ç”±ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š
>
> 1. å††å½¢ã®å½¢çŠ¶ï¼šå¤šãã®ã‚¦ã‚¤ãƒ«ã‚¹ã€ç‰¹ã«ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã¯çƒå½¢ã¾ãŸã¯å††å½¢ã®å½¢çŠ¶ã‚’æŒã¡ã¾ã™ã€‚
> 2. ä¸è¦å‰‡ãªå½¢ã®å°ã•ãªç²’å­ï¼šã“ã‚Œã¯ã‚¦ã‚¤ãƒ«ã‚¹ã®è¡¨é¢ã«ã‚ã‚‹çªèµ·ï¼ˆã‚¹ãƒ‘ã‚¤ã‚¯ã‚¿ãƒ³ãƒ‘ã‚¯è³ªï¼‰ã‚’è¡¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚
> 3. å¯†ã«è©°ã¾ã£ãŸæ§‹é€ ï¼šã‚¦ã‚¤ãƒ«ã‚¹ã®å†…éƒ¨ã¯éºä¼ç‰©è³ªã‚„ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã§å¯†ã«æº€ãŸã•ã‚Œã¦ã„ã¾ã™ã€‚
> 4. ãƒªãƒ³ã‚°çŠ¶ã®é…ç½®ï¼šã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã®ç‰¹å¾´çš„ãªã€Œç‹å† ã€ã®ã‚ˆã†ãªå¤–è¦³ã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚
> 5. ä¸­å¿ƒãŒæœ€ã‚‚å¤§ãã„ï¼šã“ã‚Œã¯ã‚¦ã‚¤ãƒ«ã‚¹ã®æ ¸ï¼ˆéºä¼ç‰©è³ªã‚’å«ã‚€éƒ¨åˆ†ï¼‰ã‚’è¡¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
> 6. ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®ã‚ã‚‹è¡¨é¢ï¼šã‚¦ã‚¤ãƒ«ã‚¹ã®è¡¨é¢ã«ã‚ã‚‹çªèµ·ï¼ˆã‚¹ãƒ‘ã‚¤ã‚¯ã‚¿ãƒ³ãƒ‘ã‚¯è³ªï¼‰ã«ã‚ˆã‚‹ã‚‚ã®ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚
> 7. ä¸Šã‹ã‚‰ã®è¦–ç‚¹ï¼šé›»å­é¡•å¾®é¡ã§ã‚¦ã‚¤ãƒ«ã‚¹ã‚’è¦³å¯Ÿã™ã‚‹éš›ã®å…¸å‹çš„ãªè¦–ç‚¹ã§ã™ã€‚
>
> ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã¯2020å¹´ä»¥é™ã€COVID-19ãƒ‘ãƒ³ãƒ‡ãƒŸãƒƒã‚¯ã®åŸå› ã¨ã—ã¦ä¸–ç•Œçš„ã«æ³¨ç›®ã•ã‚Œã¦ãŠã‚Šã€ãã®é›»å­é¡•å¾®é¡åƒã¯åºƒãå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®èª¬æ˜ã¯ãã®ã‚ˆã†ãªç”»åƒã¨éå¸¸ã«ã‚ˆãä¸€è‡´ã—ã¾ã™ã€‚
>
> ãŸã ã—ã€ä»–ã®ã‚¦ã‚¤ãƒ«ã‚¹ã‚„å¾®å°ãªçƒçŠ¶ç²’å­ã§ã‚‚ä¼¼ãŸã‚ˆã†ãªç‰¹å¾´ã‚’æŒã¤å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€100%ã®ç¢ºå®Ÿæ€§ã§ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã ã¨æ–­è¨€ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ç”»åƒè‡ªä½“ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚Œã°ã€ã‚ˆã‚Šæ­£ç¢ºãªåˆ¤æ–­ãŒå¯èƒ½ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ãªã‚“ã¨èª¬æ˜ã ã‘ã§ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã¨åˆ¤æ–­ã§ãã‚‹ã¨ã„ã†çµæœãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€ã‚ã¾ã‚ŠæœŸå¾…ã—ã¦ãªã‹ã£ãŸã®ã§ã“ã®çµæœã¯é©šãã§ã™ã€‚  
Claude ãŒå„ªã‚Œã¦ã„ã‚‹å´é¢ã‚‚ã‚ã‚Šã¾ã™ãŒã€Florence 2 ã¯é©åˆ‡ã«ç”»åƒã‚’èª­ã¿å–ã£ã¦ Caption ã‚’ç”Ÿæˆã§ãã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚

ã¡ãªã¿ã«ç”»åƒã ã‘ã‚’ä¸ãˆã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœã«ãªã‚Šã€ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã®ç‰¹å®šã¾ã§ã¯è‡³ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

> ã“ã®ç”»åƒã¯é›»å­é¡•å¾®é¡ã§æ’®å½±ã•ã‚ŒãŸã‚¦ã‚¤ãƒ«ã‚¹ç²’å­ã®ã‚ˆã†ã§ã™ã€‚ä¸­å¤®ã«çƒçŠ¶ã®æ§‹é€ ä½“ãŒè¦‹ãˆã€ãã®å‘¨ã‚Šã«æš—ã„å¤–æ®»ã‚„è¡¨é¢ã®ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã¨æ€ã‚ã‚Œã‚‹æ§‹é€ ãŒç¢ºèªã§ãã¾ã™ã€‚
>
> ã‚¦ã‚¤ãƒ«ã‚¹ã®ç¨®é¡ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã¯é›£ã—ã„ã§ã™ãŒã€å¤šãã®ã‚¦ã‚¤ãƒ«ã‚¹ãŒã“ã®ã‚ˆã†ãªçƒå½¢ã®æ§‹é€ ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã€ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ã‚¦ã‚¤ãƒ«ã‚¹ã€ãƒãƒ­ã‚¦ã‚¤ãƒ«ã‚¹ãªã©ãŒä¼¼ãŸã‚ˆã†ãªå½¢æ…‹ã‚’ç¤ºã—ã¾ã™ã€‚
>
> ãŸã ã—ã€ã“ã‚Œã¯ä¸€èˆ¬çš„ãªè¦³å¯Ÿã«åŸºã¥ãæ¨æ¸¬ã§ã‚ã‚Šã€æ­£ç¢ºãªåŒå®šã«ã¯ã•ã‚‰ãªã‚‹å°‚é–€çš„ãªåˆ†æãŒå¿…è¦ã§ã™ã€‚ã“ã®ç”»åƒã ã‘ã§ã¯ç‰¹å®šã®ã‚¦ã‚¤ãƒ«ã‚¹ã‚’æ–­å®šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
>
> ã‚¦ã‚¤ãƒ«ã‚¹å­¦ã‚„å¾®ç”Ÿç‰©å­¦ã®ç ”ç©¶ã«ãŠã„ã¦ã€ã“ã®ã‚ˆã†ãªé›»å­é¡•å¾®é¡ç”»åƒã¯ç—…åŸä½“ã®æ§‹é€ ã‚’ç†è§£ã—ã€ãã®ç‰¹æ€§ã‚’ç ”ç©¶ã™ã‚‹ä¸Šã§éå¸¸ã«é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¦ã„ã¾ã™ã€‚

:::

### ç”»åƒå†…æ¤œç´¢

ã¾ãšã¯å˜ç´”ãªä¾‹ã§è©¦ã—ã¦ã¿ã¾ã™ã€‚

```python
prompt = "<OPEN_VOCABULARY_DETECTION>"
results = run_example(prompt, "circle")
```

ä»¥ä¸‹ã®å‡¦ç†ã§ç‰©ä½“æ¤œå‡ºã®è¡¨ç¤ºç”¨ã«çµæœã‚’æ•´å½¢ã—ã¾ã™ã€‚

```python
def convert_to_od_format(data):
    """
    Converts a dictionary with 'bboxes' and 'bboxes_labels' into a dictionary with separate 'bboxes' and 'labels' keys.

    Parameters:
    - data: The input dictionary with 'bboxes', 'bboxes_labels', 'polygons', and 'polygons_labels' keys.

    Returns:
    - A dictionary with 'bboxes' and 'labels' keys formatted for object detection results.
    """
    # Extract bounding boxes and labels
    bboxes = data.get('bboxes', [])
    labels = data.get('bboxes_labels', [])

    # Construct the output format
    od_results = {
        'bboxes': bboxes,
        'labels': labels
    }

    return od_results
```

```python
od_results = convert_to_od_format(results["<OPEN_VOCABULARY_DETECTION>"])
plot_bbox(image, od_results)
```

![Circle ã‚’æ¤œå‡º](/images/florence2/CircleSearch_Result.png)

`circle` ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä¸ãˆãŸã¨ã“ã‚ã€ç”»åƒå†…ã«å††å½¢ã®ç‰©ä½“ã‚’æ¤œå‡ºã§ãã¾ã—ãŸã€‚  
ä¸€èˆ¬çš„ãªçŸ¥è­˜ã§ã‚ã‚Œã°æ¤œå‡ºã§ãã‚‹äº‹ãŒã‚ã‹ã£ãŸã®ã§ã€æ¬¡ã«ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã‚’æ¤œå‡ºã—ã¦ã¿ã¾ã™ã€‚

```python
results = run_example(prompt, "Covid-19 virus")
od_results = convert_to_od_format(results["<OPEN_VOCABULARY_DETECTION>"])
plot_bbox(image, od_results)
```

![ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã¯æ¤œçŸ¥ã§ããš](/images/florence2/Covid-19_Result.png)

`Covid-19 virus` ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä¸ãˆãŸã¨ã“ã‚ã€ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹å˜ç‹¬ã§ã¯æ¤œå‡ºã§ããšã€ç”»åƒå…¨ä½“ãŒã‚¦ã‚¤ãƒ«ã‚¹ã®ç”»åƒã§ã‚ã‚‹ã¨åˆ¤å®šã•ã‚Œã¾ã—ãŸã€‚  
é–“é•ã£ã¦ã¯ã„ãªã„ã®ã§ã™ãŒã€ã‚‚ã†å°‘ã—å…·ä½“çš„ã«æ¤œå‡ºã§ãã‚‹ã¨è‰¯ã‹ã£ãŸã§ã™ã€‚

å°‚é–€çš„ã™ãã‚‹å›ºæœ‰åè©ã¯é›£ã—ã„ã®ã‹ã¨æ€ã£ãŸã®ã§ã€ã‚‚ã†ã¡ã‚‡ã£ã¨ä¸€èˆ¬çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã¾ã™ã€‚

```python
results = run_example(prompt, "A virus")
od_results = convert_to_od_format(results["<OPEN_VOCABULARY_DETECTION>"])
plot_bbox(image, od_results)
```

![ã‚¦ã‚¤ãƒ«ã‚¹æ¤œçŸ¥ã¯ã‚„ã‚„è‰¯ã„çµæœã«](/images/florence2/Virus_Result.png)

`A virus` ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä¸ãˆãŸã¨ã“ã‚ã€ã‚¦ã‚¤ãƒ«ã‚¹ã‚’æ¤œå‡ºã§ãã¾ã—ãŸã€‚  
ãŸã æ¤œå‡ºçµæœãŒè¤‡æ•°ã‚ã‚Šã€ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹åŒæ§˜ç”»åƒå…¨ä½“ã‚‚æ¤œå‡ºã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã‚‚ã†å°‘ã—ç²¾åº¦ãŒæ¬²ã—ã„ã¨ã“ã‚ã§ã™ã€‚  
ä»Šå›ã®ä¾‹ã ã¨ `Phrase Grounding` ã®æ–¹ãŒç²¾åº¦ãŒé«˜ã„çµæœãŒå¾—ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã€ã‚¿ã‚¹ã‚¯ã«åˆã‚ã›ã¦ä½¿ã„åˆ†ã‘ãŒå¿…è¦ã ã¨æ„Ÿã˜ã¾ã—ãŸã€‚

## ã¾ã¨ã‚

Florence2 ã¯å¤šæ§˜ãª Vision ã‚¿ã‚¹ã‚¯ã«å¯¾å¿œã—ãŸãƒ¢ãƒ‡ãƒ«ã§ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ™ãƒ¼ã‚¹ã§åˆ©ç”¨ã§ãã‚‹ã®ãŒå¤§ããªç‰¹å¾´ã§ã™ã€‚  
ä»Šå›ã¯ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã®é¡•å¾®é¡åƒã¨ã„ã†ç‰¹æ®Šãªç”»åƒã‚’ä½¿ã£ã¦è©¦ã—ã¾ã—ãŸãŒã€ãã®ã†ãˆã§æ¯”è¼ƒçš„è‰¯ã„çµæœãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚  
ä¸€èˆ¬çš„ãªç”»åƒã§ã‚ã‚Œã°ã‚ˆã‚Šé«˜ã„ç²¾åº¦ãŒæœŸå¾…ã§ãã‚‹ã¨æ„Ÿã˜ã¾ã™ã€‚

ã¾ãŸå®Ÿéš›ã«ä½¿ã£ã¦ã¿ã¦ç‰¹ã«é­…åŠ›ã‚’æ„Ÿã˜ãŸã®ã¯å®Ÿè¡Œé€Ÿåº¦ã®é€Ÿã•ã§ã™ã€‚  
ã©ã®ã‚¿ã‚¹ã‚¯ã‚‚ã»ã¼1ç§’ç¨‹åº¦ã§çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã®ã§ã€å®Ÿé‹ç”¨ã‚‚ååˆ†å¯èƒ½ã ã¨æ„Ÿã˜ã¾ã—ãŸã€‚

Florence 2 å«ã‚ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ AI ã¯ã¾ã™ã¾ã™é€²åŒ–ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‹ã‚‰ã‚‚æ³¨ç›®ã—ã¦ã„ããŸã„ã§ã™ã€‚
